\RequirePackage{ifthen}
\RequirePackage{cclicenses}
\RequirePackage{etoolbox}

%% Page Style to put numbers at the top.
%\pagestyle{myheadings}


%% These commands give us values for strings that we will use
%% more than once in the commands below.

\newcommand{\completetitle}[1]{%
\newcommand{\CompleteTitle}{#1}
}

\newcommand{\fullname}[1]{%
\newcommand{\FullName}{#1}
}

\newcommand{\degreename}[1]{%
\newcommand{\DegreeName}{#1}
}

\renewcommand*\l@part[2]{%
  \ifnum \c@tocdepth >-2\relax
    \addpenalty{-\@highpenalty}%
    \addvspace{2.25em \@plus\p@}%
    \setlength\@tempdima{3em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      {\leavevmode
       %\large \bfseries %#1\hfil \hb@xt@\@pnumwidth{\hss #2}}\par
	   {#1}\nobreak \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill\nobreak
       %\hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #2}%
       \hb@xt@\@pnumwidth{\hfil \normalcolor #2}%
       \par}
       \nobreak
         \global\@nobreaktrue
         \everypar{\global\@nobreakfalse\everypar{}}%
    \endgroup
  \fi}

\renewcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode %\bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      %#1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      {#1}\nobreak \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill\nobreak
      %\hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #2}%
      \hb@xt@\@pnumwidth{\hfil \normalcolor #2}%
      \par
      \penalty\@highpenalty
    \endgroup
  \fi}

\renewcommand*\l@chapter[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode %\bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      %#1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      {#1}\nobreak \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill\nobreak
      %\hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #2}%
      \hb@xt@\@pnumwidth{\hfil \normalcolor #2}%
      \par
      \penalty\@highpenalty
    \endgroup
  \fi}

\renewcommand*\l@figure[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode %\bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      %#1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      {#1}\nobreak \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill\nobreak
      %\hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #2}%
      \hb@xt@\@pnumwidth{\hfil \normalcolor #2}%
      \par
      \penalty\@highpenalty
    \endgroup
  \fi}

\renewcommand*\l@table[2]{%
  \ifnum \c@tocdepth >\m@ne
    \addpenalty{-\@highpenalty}%
    \vskip 1.0em \@plus\p@
    \setlength\@tempdima{1.5em}%
    \begingroup
      \parindent \z@ \rightskip \@pnumwidth
      \parfillskip -\@pnumwidth
      \leavevmode %\bfseries
      \advance\leftskip\@tempdima
      \hskip -\leftskip
      %#1\nobreak\hfil \nobreak\hb@xt@\@pnumwidth{\hss #2}\par
      {#1}\nobreak \leaders\hbox{$\m@th
        \mkern \@dotsep mu\hbox{.}\mkern \@dotsep mu$}\hfill\nobreak
      %\hb@xt@\@pnumwidth{\hfil\normalfont \normalcolor #2}%
      \hb@xt@\@pnumwidth{\hfil \normalcolor #2}%
      \par
      \penalty\@highpenalty
    \endgroup
  \fi}

% We renewed the following command so that the chapter level items in
% the TOC have the correct word (nothing|Chapter|Appendix) in front of
% them.
%
% Otherwise this command is identical to \def\@chapter in the
% 2001/04/21 v1.4e book.cls.
\renewcommand\@chapter[2][\#2]{\ifnum \c@secnumdepth >\m@ne
	   \if@mainmatter
	     \refstepcounter{chapter}%
	     \typeout{\@chapapp\space\thechapter.}%
	     \addcontentsline{toc}{chapter}%
	               %{\protect\numberline{\thechapter}#1}%
	               {\@chapapp\space\protect\numberline{\thechapter}#1}%
	   \else
	     \addcontentsline{toc}{chapter}{#1}%
	   \fi
	\else
	  \addcontentsline{toc}{chapter}{#1}%
	\fi
	\chaptermark{#1}%
	\addtocontents{lof}{\protect\addvspace{10\p@}}%
	\addtocontents{lot}{\protect\addvspace{10\p@}}%
	\if@twocolumn
	  \@topnewpage[\@makechapterhead{#2}]%
	\else
	  \@makechapterhead{#2}%
	  \@afterheading
	\fi}

% In the same vein as above, the following was renewed so that part
% level items in the TOC will have the correct word.  Similarly, font
% size and bolding are removed to stay consistent with TOC.
%
% Otherwise this command is identical to \def\@part in the
% 2004/02/16 v1.4f book.cls
\renewcommand\@part[2][\#2]{%
    \ifnum \c@secnumdepth >-2\relax
      \refstepcounter{part}%
      \addcontentsline{toc}{part}%{\thepart\hspace{1em}#1}%
		{\partname\space\thepart\hspace{1em}#1}%
    \else
      \addcontentsline{toc}{part}{#1}%
    \fi
    %\markboth{}{}%
    {\centering
     \interlinepenalty \@M
     \normalfont
     \ifnum \c@secnumdepth >-2\relax
       %\huge\bfseries \partname\nobreakspace\thepart
       \partname\nobreakspace\thepart
       \par
       \vskip 20\p@
     \fi
     %\Huge \bfseries #2\par}%
     #2\par}%
    \@endpart}




%%---------------------------- Title Page -----------------------------
%%
%% \maketitlepage{Title}{Author}{degree title}{Department}{y e a r}
%%
%% options are	#1 = Title
%%				#2 = Author
%%				#3 = degree title
%%				#4 = Department
%%				#5 = year

\newcommand{\maketitlepage}[2]{%

% This bracket begins an unnamed environment in which we will temporarily
% override the document's page style.
{
\thispagestyle{empty}				% no page number on title page
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

\vspace*{0.25in}	% This accounts for the larger top margin.  You'd think
\begin{center}		%	this would be 1in, but that pushes it down too far?
{\large\MakeUppercase{\CompleteTitle}}	% Title text

\bigskip

\bigskip

by

\bigskip

\FullName							% Author
\vspace{.75in}

\rule{2.25in}{1pt} \\
% This puts in the Copyright statement
%{\footnotesize~~~Copyright \copyright\ \FullName\ #2}
\ifthenelse{\equal{\LicenseType}{copyright}}{\footnotesize~~~Copyright \copyright\ \FullName\ #2}{}
% Creative Commons licenses
\ifthenelse{\equal{\LicenseType}{CCBY}}{\footnotesize\cc \by Creative Commons Attribution 3.0 License}{}
\ifthenelse{\equal{\LicenseType}{CCBYND}}{\footnotesize\cc \bynd Creative Commons Attribution-No Derivative Works 3.0 License}{}
\ifthenelse{\equal{\LicenseType}{CCBYSA}}{\footnotesize\cc \bysa Creative Commons Attribution-Share Alike 3.0 License}{}

\small\normalsize					% size switch to make the spacing behave

\vspace{0.5in}

A \ThesisType\ Submitted to the Faculty of the

\bigskip
\bigskip

\MakeUppercase{#1}					% Department

\bigskip
\bigskip

In Partial Fulfillment of the Requirements\\
\bigskip
For the Degree of

\bigskip
\bigskip

\MakeUppercase{\DegreeName}					% Degree Title

\bigskip
\bigskip

In the Graduate College

\bigskip
\bigskip

THE UNIVERSITY OF ARIZONA

\vfill
\ifthenelse{ \boolean{GeneratedOn} }
{This draft was generated on \today.}
{#2}								% Year
\vspace{0.5in} % This accounts for the 0.5in larger bottom margin on this page.
\end{center}
}

}


%%---------------------------- Approval Form --------------------------
%%
%% This creates the Committee Approval form, the arguments are as
%% follows:	#1	defense date
%%			#2	Dissertation Director's name
%%			#3	1st committee member's name
%%			#4	2nd committee member's name
%%			#5	3rd committee member's name
%%			#6	4th committee member's name
%%			#7	5th committee member's name

\newcommand{\approval}[7][]{%

{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize

\ifthenelse{\boolean{Proposal}}{%
  % Proposal's headings aren't centered by default and have smaller spacing
  \chapter*{\center THE UNIVERSITY OF ARIZONA\\GRADUATE COLLEGE}\vskip 30\p@
}{%
  \chapter*{THE UNIVERSITY OF ARIZONA\\GRADUATE COLLEGE}
}


As members of the Dissertation Committee, we certify that we have
read the \MakeLowercase{\ThesisType} prepared by \FullName,
titled \CompleteTitle~and recommend that it be accepted as fulfilling the
\MakeLowercase{\ThesisType} requirement for the Degree of \DegreeName.

% Before the final oral defense you must obtain the Approval Pages
% from the Degree Certification Office. Original signatures are
% required on both final copies.  That means print out the Approval
% Forms (one for each copy of the \ThesisType) on the nice acid-free
% paper and get original signatures on each one.  Do this at your
% defense to keep from having to do another signature round-up later
% on.

\vfill

\bigskip
\begin{flushleft}
\begin{tabular*}{\textwidth}{p{4in}@{\extracolsep{\fill}}l}
	& Date: #1	\\
\cline{1-1}
#2	& 			\\
	&			\\
	&			\\
	& Date: #1	\\
\cline{1-1}
#3	& 			\\
	&			\\
	&			\\
	& Date: #1	\\
\cline{1-1}
#4	& 			\\
\end{tabular*}
\end{flushleft}

\ifthenelse{\boolean{Proposal}}{}{
\vfill

\noindent Final approval and acceptance of this \MakeLowercase{\ThesisType} is
contingent upon the candidate's submission of the final copies of the
\MakeLowercase{\ThesisType} to the Graduate College.

\bigskip
}

\noindent I hereby certify that I have read this \MakeLowercase{\ThesisType} prepared
under my direction and recommend that it be accepted as fulfilling the
\MakeLowercase{\ThesisType} requirement.

\vfill

\bigskip
\begin{flushleft}
\begin{tabular*}{\textwidth}{p{4in}@{\extracolsep{\fill}}l}
							& Date: #1	\\
\cline{1-1}
Dissertation Director: #2	&			\\
\end{tabular*}
\end{flushleft}

\bigskip
\begin{flushleft}
\begin{tabular*}{\textwidth}{p{4in}@{\extracolsep{\fill}}l}
							& Date: #1	\\
\cline{1-1}
Dissertation Director: #3	&			\\
\end{tabular*}
\end{flushleft}
\vspace{1.5in} % This accounts for the 0.5in larger bottom margin on this page.
}

}

%%---------------------------- Statement by Author --------------------
%% \statementbyauthor
%%

\newcommand{\statementbyauthor}[1][\emph{Put your Thesis Director's name and title into square brackets, [], after the statementbyauthor command}]{

%% This bracket begins an unnamed environment in which we will temporarily
%% override the document's page style.
{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

% The vspace in the chapter command below accounts for the extra 1in of
% margin at the top needed for this page (total should be 2.5in).
\ifthenelse{\boolean{Proposal}}{%
  % Proposal's headings aren't centered by default and have smaller spacing
  \chapter*{\center\vspace*{1in}STATEMENT BY AUTHOR}\vskip 30\p@
}{%
  \chapter*{\vspace*{1in}STATEMENT BY AUTHOR}
}


This \MakeLowercase{\ThesisType} has been submitted in partial
fulfillment of the requirements for an advanced degree at the
University of Arizona and is deposited in the University Library
to be made available to borrowers under rules of the Library.

\bigskip
%
\noindent Brief quotations from this \MakeLowercase{\ThesisType} are allowable
without special permission, provided that an accurate acknowledgement
of the source is made.
\ifthenelse{ \equal{\LicenseType}{copyright} }
{Requests for permission for extended quotation
from or reproduction of this manuscript in whole or in part may be
granted by the copyright holder.}
% CC BY ND
\ifthenelse{ \equal{\LicenseType}{CCBYND} }
{This work is licensed under the Creative Commons Attribution-No Derivative Works 3.0 United States License. To view a copy of this
license, visit \href{http://creativecommons.org/licenses/by-nd/3.0/us/}{http://creativecommons.org/\allowbreak licenses/\allowbreak by-nd/\allowbreak 3.0/\allowbreak us/} or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.

%Requests for permission for extended quotation from or reproduction of this manuscript in whole or in part may be granted by the head of the major department or the Dean of the Graduate College when in his or her judgment the proposed use of the material is in the interests of scholarship.  In all other instances, however, permission must be obtained from the author.
}
% %
% {\ifthenelse{ \equal{\LicenseType}{CCBYSA} }
% {This work is licensed under the Creative Commons Attribution-Share
% Alike 3.0 United States License. To view a copy of this license, visit
% \href{http://creativecommons.org/licenses/by-sa/3.0/us/}
% {\mbox{http://creativecommons.org/licenses/by-sa/3.0/us/}} or send a letter to
% Creative Commons, 171 Second Street, Suite 300, San Francisco,
% California, 94105, USA.}{}
% %

\vspace{1in}

\begin{flushleft}
\begin{tabular*}{\textwidth}{p{2.5in}@{\extracolsep{\fill}}rp{2.5in}}
\ifthenelse{ \equal{\ThesisType}{Thesis} }
{
							& SIGNED:	& 	\\
\cline{3-3}
							&			& \hfill \FullName	\\
} {
							& SIGNED:	& \FullName	\\
}
\end{tabular*}
\end{flushleft}

% If this is a Thesis, we need a permission and date statement.
\ifthenelse{ \equal{\ThesisType}{Thesis} }
{
\vfill
\begin{center}
APPROVAL BY THESIS DIRECTOR

\bigskip

This thesis has been approved on the date shown below:

\vspace{0.75in}

\begin{minipage}[t]{4in}
\begin{center}
\hrulefill

#1
%Jane M. Doe\\
%Professor of Chemistry
\end{center}
\end{minipage}
\hfill
\begin{minipage}[t]{1.75in}
\begin{center}
\hrulefill

Date
\end{center}
\end{minipage}


\end{center}
}

}

}


%%---------------------------- Acknowledgements -----------------------
%%
%% This command includes the file that contains the acknowledgements.
%%
%% \incacknowledgements
%% Option is #1 = acknowledgements file name
%%

\newcommand{\incacknowledgements}[1]{

% This bracket begins an unnamed environment in which we will temporarily
% override the document's page style.
{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

\chapter*{Acknowledgements}

\InputIfFileExists{#1}
	{\typeout{Including your file #1.tex as the acknowledgements.}}
	{Couldn't find #1.tex to include as your acknowledgements.}

}
}


%%---------------------------- Dedication -----------------------------
%%
%% This command includes the file that contains the dedication.
%%
%% \incdedication
%% Option is #1 = dedication file name
%%

\newcommand{\incdedication}[1]{

\chapter*{Dedication}

\InputIfFileExists{#1}
	{\typeout{Including your file #1.tex as the dedication.}}
	{Couldn't find #1.tex to include as your dedication.}

}


%%---------------------------- Abstract -------------------------------
%%
%% This command includes the file that contains the abstract.
%%
%% \incabstract
%% Option is #1 = abstract file name
%%

\newcommand{\incabstract}[1]{

\chapter*{Abstract}
\addcontentsline{toc}{chapter}{Abstract}

\InputIfFileExists{#1}
	{\typeout{Including your file #1.tex as the abstract.}}
	{Couldn't find #1.tex to include as your abstract.}

}


%%---------------------------- Special Abstract -----------------------
%%
%% This command includes the file that contains the abstract, but it
%% also allows for extra information to be placed in the header for
%% the special abstract.
%%
%% \incspecialabstract
%% Options are	#1 = abstract file name
%% 				#2 = Title
%%				#3 = Author, Ph.D.
%%				#4 = year
%%				#5 = Thesis Director (needed for everything or just Masters?)
\newcommand{\incspecialabstract}[5]{

\thispagestyle{empty}				% no page number on these pages

\begin{center}
{\large\MakeUppercase{#2}}

\bigskip

\renewcommand{\baselinestretch}{1}	% single spaced to end of paragraph.
\small\normalsize					% size switch to make the spacing behave
#3\\
The University of Arizona, #4

\end{center}

\noindent Director: #5

\bigskip

\InputIfFileExists{#1}
	{\typeout{Including your file #1.tex as the special abstract.}}
	{Couldn't find #1.tex to include as your special abstract.}
}


%%---------------------------- Table of Contents ----------------------
%%
%% The table of contents that the UofA wants is subtley different in a
%% number of ways such that we need to redefine the \tableofcontents
%% command provided by the basic LaTeX classes.  Many of the commands
%% here are confusing, but were taken from the LaTeX book.cls class
%% file with the following date and version stamp: 2001/04/21 v1.4e
%%
\renewcommand{\tableofcontents}{

\addtolength{\headsep}{0.5in}		% These adjust things for the running
\addtolength{\textheight}{-0.5in}	% headers for TOC, LOF, LOT.

% This bracket begins an unnmaed environment in which we will temporarily
% override the document's page style and margins
{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

\if@twocolumn					% \
	\@restonecoltrue\onecolumn	%  \
\else							% 	> Taken from book.cls
	\@restonecolfalse			%  /
\fi								% /

% vspace added to account for the TOC, LOF, & LOT running header business.
\chapter*{\vspace*{-0.5in}\contentsname}

% \markboth{	\protect\raisebox{-0.5in}{\textbf{\emph{\contentsname} -- Continued}\hspace{1.5in}} }{
% 			\protect\raisebox{-0.5in}{\hspace{1.5in}\textbf{\emph{\contentsname} -- Continued}} }
%\markboth{\emph{\contentsname} -- Continued}{\emph{\contentsname} -- Continued}

\@starttoc{toc}%
\if@restonecol\twocolumn\fi		% Taken from book.cls
}
}



%%---------------------------- List of Figures ------------------------
%%
%% The U of A List of Figures requires a running header on subsequent
%% pages that we must define here.  We also add this section to the TOC.
%% This was modified from the definition for listoffigures from
%% 2001/04/21 v1.4e book.cls.
%%
\renewcommand{\listoffigures}{%
% This bracket begins an unnmaed environment in which we will temporarily
% override the document's page style and margins
{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

    \if@twocolumn
      \@restonecoltrue\onecolumn
    \else
      \@restonecolfalse
    \fi
	% vspace added to account for the TOC, LOF, & LOT running header business.
    \chapter*{\vspace*{-0.5in}\listfigurename}%

	% \markboth{\protect\raisebox{-0.5in}{\textbf{\emph{\listfigurename} -- Continued}\hspace{1.5in}} }{
	% 		  \protect\raisebox{-0.5in}{\hspace{1.5in}\textbf{\emph{\listfigurename} -- Continued}} }
%\markboth{\emph{\listfigurename} -- Continued}{\emph{\listfigurename} -- Continued}

	\addcontentsline{toc}{chapter}{\listfigurename}
    \@starttoc{lof}%
    \if@restonecol\twocolumn\fi
}
}

%%---------------------------- List of Tables -------------------------
%%
%% The U of A List of Tables requires a running header on subsequent
%% pages that we must define here.  We also add this section to the TOC.
%% This was modified from the definition for listoffigures from
%% 2001/04/21 v1.4e book.cls.
%%
\renewcommand{\listoftables}{%
% This bracket begins an unnmaed environment in which we will temporarily
% override the document's page style and margins
{
\renewcommand{\baselinestretch}{1}	% single spaced here
\small\normalsize					% size switch to make the spacing behave

    \if@twocolumn
      \@restonecoltrue\onecolumn
    \else
      \@restonecolfalse
    \fi
	% vspace added to account for the TOC, LOF, & LOT running header business.
    \chapter*{\vspace*{-0.5in}\listtablename}%

	% \markboth{\protect\raisebox{-0.5in}{\textbf{\emph{\listtablename} -- Continued}\hspace{1.5in}} }{
	% 		  \protect\raisebox{-0.5in}{\hspace{1.5in}\textbf{\emph{\listtablename} -- Continued}} }
%\markboth{\emph{\listtablename} -- Continued}{\emph{\listtablename} -- Continued}

	\addcontentsline{toc}{chapter}{\listtablename}
    \@starttoc{lot}%
    \if@restonecol\twocolumn\fi
}

\clearpage
\addtolength{\headsep}{-0.5in}		% Un-adjust things for the running
\addtolength{\textheight}{0.5in}	% headers for TOC, LOF, LOT.
}

\makeatletter
\newif\if@tufte@margtab\@tufte@margtabfalse
\AtBeginEnvironment{margintable}{\@tufte@margtabtrue}
\AtEndEnvironment{margintable}{\@tufte@margtabfalse}
\newcommand{\classiccaptionstyle}{%
    \long\def\@caption##1[##2]##3{%
        \par
        \addcontentsline{\csname ext@##1\endcsname}{##1}%
        {\protect\numberline{\csname the##1\endcsname}{\ignorespaces ##2}}%
        \begingroup
        \@parboxrestore
        \if@minipage
        \@setminipage
        \fi
        \normalsize
        \@makecaption{\csname fnum@##1\endcsname}{\ignorespaces ##3}\par
        \endgroup}
    \long\def\@makecaption##1##2{%
        \vskip\abovecaptionskip
        \sbox\@tempboxa{\@tufte@caption@font##1: ##2}%
        \ifdim \wd\@tempboxa >\hsize
        \@tufte@caption@font\if@tufte@margtab\@tufte@caption@justification\fi##1: ##2\par
        \else
        \global \@minipagefalse
        \hb@xt@\hsize{\hfil\box\@tempboxa\hfil}%
        \fi
        \vskip\belowcaptionskip}
    %   \setcaptionfont{\normalfont}
    \let\caption\@tufte@orig@caption%
    \let\label\@tufte@orig@label}
\makeatother

\AtBeginEnvironment{threeparttable}{%
    \classiccaptionstyle}


%\markboth{}{}
